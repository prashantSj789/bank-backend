name: deploy go bank

on:
  push:
    branches:
      -main


jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Source
        uses: actions/checkout@v4
      - name: Create .env file
        run:  echo "PORT = ${{ secrets.PORT }}" >> .env
      - name: login to docker hub
        run: docker login -u ${{ secrets.DOCKER_USER_NAME }} -p ${{ secrets.DOCKER_PASSWORD }}
  deploy:
    needs: build
    runs-on: ip-172-31-22-24
    steps:
      - name: pull docker image
      - run: docker pull kubeprashant798/go-bank:latest
      - name: delete old container 
      - run: docker rm -f go-bank-container
      - name: Run docker container
      - run: docker run -d -p 8080:8080 --name go-bank-container kubeprashant798/go-bank